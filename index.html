<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Carnet de D√©briefing</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      background-color: #f4f4f9;
    }
    nav {
      background-color: #333;
      color: #fff;
    }
    nav ul {
      list-style-type: none;
      margin: 0;
      padding: 0;
      display: flex;
    }
    nav li {
      padding: 10px 20px;
      cursor: pointer;
    }
    nav li:hover {
      background-color: #444;
    }
    nav li.active {
      background-color: #555;
    }
    .hidden {
      display: none;
    }
    .container {
      max-width: 800px;
      margin: 20px auto;
      padding: 20px;
      background: #fff;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
    }
    h1, h2 {
      text-align: center;
      color: #333;
    }
    form {
      display: flex;
      flex-direction: column;
      gap: 15px;
    }
    label {
      font-weight: bold;
    }
    input,
    textarea,
    select,
    button {
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 5px;
      font-size: 16px;
    }
    button {
      background-color: #5cb85c;
      color: white;
      cursor: pointer;
    }
    button:hover {
      background-color: #4cae4c;
    }
    .checkbox-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
    }
    .checkbox-grid div {
      display: flex;
      align-items: center;
    }
    .two-columns {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 15px;
    }
    .stars {
      display: flex;
      gap: 5px;
      font-size: 24px;
    }
    .stars input {
      display: none;
    }
    .stars label {
      cursor: pointer;
      color: lightgray;
    }
    .stars input:checked ~ label,
    .stars label:hover,
    .stars label:hover ~ label {
      color: gold;
    }
    .radar-section {
      margin: 20px 0;
    }
    table {
      width: 100%;
      border-collapse: collapse;
    }
    table th,
    table td {
      border: 1px solid #ccc;
      padding: 8px;
      text-align: left;
    }
    table th {
      background-color: #eee;
    }
    /* Boutons dans le tableau */
    .edit-btn {
      background-color: #0275d8;
      margin-right: 5px;
    }
    .edit-btn:hover {
      background-color: #025aa5;
    }
    .delete-btn {
      background-color: #d9534f;
    }
    .delete-btn:hover {
      background-color: #c9302c;
    }
  </style>
</head>
<body>

  <!-- Barre de navigation (onglets) -->
  <nav>
    <ul>
      <li id="tabNew" class="active">Nouveau Carnet</li>
      <li id="tabHistory">Historique</li>
    </ul>
  </nav>

  <!-- SECTION : NOUVEAU CARNET -->
  <div class="container" id="newCarnetSection">
    <h1>Carnet de D√©briefing</h1>
    <h2>Avant Vol</h2>

    <form id="debriefForm">
      <!-- Champ cach√© pour stocker l'ID du carnet en cas d'√©dition -->
      <input type="hidden" id="editIndex" value="">

      <!-- 1: Date -->
      <label for="date">Date</label>
      <input type="date" id="date" name="date" required>

      <!-- 2: Site -->
      <label for="session">Site</label>
      <input type="text" id="session" name="session" placeholder="Entrer un site" required>

      <!-- 3: M√©t√©o int√©rieure -->
      <label for="participants">Ma m√©t√©o int√©rieure</label>
      <textarea id="participants" name="participants" rows="3" placeholder="Ma m√©t√©o int√©rieure"></textarea>

      <!-- 4: Type d'activit√© (exemple 1) -->
      <label for="activity-type">Type d'activit√©  (exemple 1)</label>
      <select id="activity-type" name="activity-type" required>
        <option value="">-- Select an activity --</option>
        <option value="cross">Cross</option>
        <option value="record">Record</option>
        <option value="cfd">CFD</option>
        <option value="accro">Accro</option>
        <option value="repose-deco">Repose D√©co</option>
        <option value="compet">Comp√©t</option>
        <option value="exos">Exos</option>
        <option value="soaring">Soaring</option>
        <option value="loisir">Loisir</option>
        <option value="plaisir">Plaisir</option>
      </select>

      <!-- 5: Type d'activit√© (exemple 2) : Cases √† cocher -->
      <label>Type d'activit√©  (exemple 2)</label>
      <div class="checkbox-grid">
        <div>
          <input type="checkbox" id="cross" name="activity-options" value="cross">
          <label for="cross">Cross</label>
        </div>
        <div>
          <input type="checkbox" id="record" name="activity-options" value="record">
          <label for="record">Record</label>
        </div>
        <div>
          <input type="checkbox" id="cfd" name="activity-options" value="cfd">
          <label for="cfd">CFD</label>
        </div>
        <div>
          <input type="checkbox" id="accro" name="activity-options" value="accro">
          <label for="accro">Accro</label>
        </div>
        <div>
          <input type="checkbox" id="repose-deco" name="activity-options" value="repose-deco">
          <label for="repose-deco">Repose D√©co</label>
        </div>
        <div>
          <input type="checkbox" id="compet" name="activity-options" value="compet">
          <label for="compet">Comp√©t</label>
        </div>
        <div>
          <input type="checkbox" id="exos" name="activity-options" value="exos">
          <label for="exos">Exos</label>
        </div>
        <div>
          <input type="checkbox" id="soaring" name="activity-options" value="soaring">
          <label for="soaring">Soaring</label>
        </div>
        <div>
          <input type="checkbox" id="loisir" name="activity-options" value="loisir">
          <label for="loisir">Loisir</label>
        </div>
        <div>
          <input type="checkbox" id="plaisir" name="activity-options" value="plaisir">
          <label for="plaisir">Plaisir</label>
        </div>
      </div>

      <!-- 6: Donn√©es de vol -->
      <label>Donn√©es de vol</label>
      <div class="two-columns">
        <div>
          <label for="duration">Dur√©e</label>
          <input type="time" id="duration" name="duration">
        </div>
        <div>
          <label for="alti-deco">Alti d√©co (m)</label>
          <input type="number" id="alti-deco" name="alti-deco" placeholder="Enter altitude">
        </div>
        <div>
          <label for="alti-max">Alti max (m)</label>
          <input type="number" id="alti-max" name="alti-max" placeholder="Enter altitude">
        </div>
        <div>
          <label for="conditions">Conditions</label>
          <select id="conditions" name="conditions">
            <option value="sad">üòü Tr√®s compliqu√©</option>
            <option value="neutral">üòê Neutre</option>
            <option value="happy">üôÇ Content</option>
            <option value="very-happy">üòÄ Top</option>
          </select>
        </div>
        <div>
          <label for="vz-plus-max">Vz+max</label>
          <input type="number" id="vz-plus-max" name="vz-plus-max" placeholder="Enter max speed">
        </div>
        <div>
          <label for="vz-minus-max">Vz-max</label>
          <input type="number" id="vz-minus-max" name="vz-minus-max" placeholder="Enter max speed">
        </div>
      </div>

      <!-- 7: Note Globale (√©toiles) -->
      <label>Note Globale</label>
      <div class="stars">
        <input type="radio" id="star-1" name="rating" value="1">
        <label for="star-1">‚òÖ</label>
        <input type="radio" id="star-2" name="rating" value="2">
        <label for="star-2">‚òÖ</label>
        <input type="radio" id="star-3" name="rating" value="3">
        <label for="star-3">‚òÖ</label>
        <input type="radio" id="star-4" name="rating" value="4">
        <label for="star-4">‚òÖ</label>
        <input type="radio" id="star-5" name="rating" value="5">
        <label for="star-5">‚òÖ</label>
      </div>

      <!-- 8: Notes & Observations -->
      <label for="notes">Notes & Observations</label>
      <textarea id="notes" name="notes" rows="5" placeholder="Vos notes ici..."></textarea>

      <!-- 9: Radar Chart -->
      <div class="radar-section">
        <label>Radar Chart</label>
        <canvas id="radarChart" width="400" height="400"></canvas>
      </div>

      <!-- Bouton Enregistrer -->
      <button type="submit" id="saveBtn">Save</button>
    </form>
  </div>

  <!-- SECTION : HISTORIQUE DES CARNETS -->
  <div class="container hidden" id="historySection">
    <h2>Historique des Carnets</h2>
    <table id="historyTable">
      <thead>
        <tr>
          <th>Date</th>
          <th>Site</th>
          <th>Type d'activit√©</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody>
        <!-- Les lignes des carnets s‚Äôafficheront ici -->
      </tbody>
    </table>
  </div>

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    /***********************/
    /***  Radar Chart   ****/
    /***********************/
    const ctx = document.getElementById('radarChart').getContext('2d');
    const radarChart = new Chart(ctx, {
      type: 'radar',
      data: {
        labels: ['AIR', 'CNS', 'MAT', 'PHY', 'COS', 'STS', 'GES', 'DEC', 'ENV', 'PIL', 'SIV'],
        datasets: [
          {
            label: 'Radar Data',
            data: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
            backgroundColor: 'rgba(54, 162, 235, 0.2)',
            borderColor: 'rgba(54, 162, 235, 1)',
            borderWidth: 1
          }
        ]
      },
      options: {
        scales: {
          r: {
            angleLines: {
              display: true
            },
            suggestedMin: 0,
            suggestedMax: 4,
            ticks: {
              stepSize: 1,
              callback: function(value) {
                switch (value) {
                  case 1: return 'S';
                  case 2: return 'A';
                  case 3: return 'M';
                  case 4: return 'I';
                  default: return '';
                }
              }
            }
          }
        }
      }
    });

    // Cliquez sur le radar pour changer les donn√©es
    document.getElementById('radarChart').addEventListener('click', (event) => {
      const points = radarChart.getElementsAtEventForMode(event, 'nearest', { intersect: true }, true);
      if (points.length) {
        const index = points[0].index;
        const newValue = prompt(`Set value for ${radarChart.data.labels[index]} (1=S, 2=A, 3=M, 4=I):`);
        if (newValue >= 1 && newValue <= 4) {
          radarChart.data.datasets[0].data[index] = parseInt(newValue);
          radarChart.update();
        }
      }
    });

    /***********************/
    /***   Onglets UI   ****/
    /***********************/
    const tabNew = document.getElementById('tabNew');
    const tabHistory = document.getElementById('tabHistory');
    const newCarnetSection = document.getElementById('newCarnetSection');
    const historySection = document.getElementById('historySection');

    tabNew.addEventListener('click', () => {
      tabNew.classList.add('active');
      tabHistory.classList.remove('active');
      newCarnetSection.classList.remove('hidden');
      historySection.classList.add('hidden');
    });

    tabHistory.addEventListener('click', () => {
      tabHistory.classList.add('active');
      tabNew.classList.remove('active');
      newCarnetSection.classList.add('hidden');
      historySection.classList.remove('hidden');
      renderHistory(); // On met √† jour l‚Äôhistorique
    });

    /***************************/
    /***  LocalStorage Logic ***/
    /***************************/
    // R√©cup√©ration du tableau de carnets depuis localStorage (ou cr√©ation si vide)
    function getDebriefingsFromStorage() {
      let data = localStorage.getItem('debriefings');
      return data ? JSON.parse(data) : [];
    }

    // Sauvegarde du tableau de carnets dans localStorage
    function saveDebriefingsToStorage(debriefings) {
      localStorage.setItem('debriefings', JSON.stringify(debriefings));
    }

    /**********************/
    /***   Formulaire  ****/
    /**********************/
    const debriefForm = document.getElementById('debriefForm');
    debriefForm.addEventListener('submit', (event) => {
      event.preventDefault();

      // R√©cup√©ration des champs
      const editIndex = document.getElementById('editIndex').value; // si on est en mode √©dition
      const date = document.getElementById('date').value;
      const session = document.getElementById('session').value;
      const participants = document.getElementById('participants').value;
      const activityType = document.getElementById('activity-type').value;
      
      // Cases √† cocher
      const checkboxes = document.querySelectorAll('input[name="activity-options"]:checked');
      let activityOptions = [];
      checkboxes.forEach((cb) => {
        activityOptions.push(cb.value);
      });

      const duration = document.getElementById('duration').value;
      const altiDeco = document.getElementById('alti-deco').value;
      const altiMax = document.getElementById('alti-max').value;
      const conditions = document.getElementById('conditions').value;
      const vzPlusMax = document.getElementById('vz-plus-max').value;
      const vzMinusMax = document.getElementById('vz-minus-max').value;

      // Note globale (√©toiles)
      const rating = document.querySelector('input[name="rating"]:checked');
      const globalRating = rating ? rating.value : '';

      const notes = document.getElementById('notes').value;

      // Radar data
      const radarData = radarChart.data.datasets[0].data;

      // Construction de l'objet carnet
      const carnet = {
        date,
        session,
        participants,
        activityType,
        activityOptions,
        duration,
        altiDeco,
        altiMax,
        conditions,
        vzPlusMax,
        vzMinusMax,
        globalRating,
        notes,
        radarData
      };

      // R√©cup√©rer la liste existante
      let debriefings = getDebriefingsFromStorage();

      if (editIndex === '') {
        // *** Cr√©ation d‚Äôun nouveau carnet ***
        debriefings.push(carnet);
      } else {
        // *** Edition d‚Äôun carnet existant ***
        debriefings[editIndex] = carnet;
      }

      // Sauvegarde en localStorage
      saveDebriefingsToStorage(debriefings);

      // R√©initialise le formulaire
      debriefForm.reset();
      document.getElementById('editIndex').value = '';
      // R√©initialise le radar
      radarChart.data.datasets[0].data = [0,0,0,0,0,0,0,0,0,0,0];
      radarChart.update();

      // Va √† l‚Äôhistorique directement
      tabHistory.click();
    });

    /*************************/
    /***   Afficher Liste  ***/
    /*************************/
    function renderHistory() {
      let debriefings = getDebriefingsFromStorage();

      // On tri par date (du plus r√©cent au plus ancien) -- ajustable
      debriefings.sort((a, b) => new Date(b.date) - new Date(a.date));

      const tbody = document.querySelector('#historyTable tbody');
      tbody.innerHTML = '';

      debriefings.forEach((carnet, index) => {
        const row = document.createElement('tr');

        // Date
        const dateTd = document.createElement('td');
        dateTd.textContent = carnet.date;
        row.appendChild(dateTd);

        // Site
        const sessionTd = document.createElement('td');
        sessionTd.textContent = carnet.session;
        row.appendChild(sessionTd);

        // Type d‚Äôactivit√©
        const activityTd = document.createElement('td');
        activityTd.textContent = carnet.activityType;
        row.appendChild(activityTd);

        // Boutons actions
        const actionTd = document.createElement('td');
        
        const editBtn = document.createElement('button');
        editBtn.textContent = 'Modifier';
        editBtn.classList.add('edit-btn');
        editBtn.addEventListener('click', () => {
          editCarnet(index);
        });
        actionTd.appendChild(editBtn);

        const deleteBtn = document.createElement('button');
        deleteBtn.textContent = 'Supprimer';
        deleteBtn.classList.add('delete-btn');
        deleteBtn.addEventListener('click', () => {
          deleteCarnet(index);
        });
        actionTd.appendChild(deleteBtn);

        row.appendChild(actionTd);

        tbody.appendChild(row);
      });
    }

    /**********************/
    /***   Modifier    ****/
    /**********************/
    function editCarnet(index) {
      // R√©cup√©rer le carnet
      let debriefings = getDebriefingsFromStorage();
      const carnet = debriefings[index];

      // Remplir le formulaire
      document.getElementById('editIndex').value = index; 
      document.getElementById('date').value = carnet.date;
      document.getElementById('session').value = carnet.session;
      document.getElementById('participants').value = carnet.participants;
      document.getElementById('activity-type').value = carnet.activityType;

      // Cases √† cocher
      document.querySelectorAll('input[name="activity-options"]').forEach((cb) => {
        cb.checked = carnet.activityOptions.includes(cb.value);
      });

      document.getElementById('duration').value = carnet.duration;
      document.getElementById('alti-deco').value = carnet.altiDeco;
      document.getElementById('alti-max').value = carnet.altiMax;
      document.getElementById('conditions').value = carnet.conditions;
      document.getElementById('vz-plus-max').value = carnet.vzPlusMax;
      document.getElementById('vz-minus-max').value = carnet.vzMinusMax;

      // Note globale (√©toiles)
      if (carnet.globalRating) {
        document.getElementById(`star-${carnet.globalRating}`).checked = true;
      }

      document.getElementById('notes').value = carnet.notes;

      // Radar data
      radarChart.data.datasets[0].data = carnet.radarData.slice(); // .slice() pour cloner
      radarChart.update();

      // Afficher l‚Äôonglet ‚ÄúNouveau Carnet‚Äù pour pouvoir √©diter
      tabNew.click();
    }

    /**********************/
    /***   Supprimer   ****/
    /**********************/
    function deleteCarnet(index) {
      if (confirm('Voulez-vous vraiment supprimer ce carnet ?')) {
        let debriefings = getDebriefingsFromStorage();
        debriefings.splice(index, 1);
        saveDebriefingsToStorage(debriefings);
        renderHistory();
      }
    }

    // Au premier chargement, on affiche le formulaire
    tabNew.click();
  </script>
</body>
</html>